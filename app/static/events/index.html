<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=Promise"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.min.js"></script>
    <script src="https://cdnjs.com/libraries/socket.io"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/events.css">
    <link rel="stylesheet" href="/css/loader.css">


    <script type="text/x-template" id="participant-item-template">
    <div class="participant">{{ participant.name }}
        <div class="leave" v-if="participant.canLeave" v-on:click="leave()">[ X ]
        </div>
    </div>
    </script>

    <script type="text/x-template" id="event-item-template">
    <div class="container-fluid event">
        <div class="row event-header" v-on:click="toggleVisible">
            <div class="col-xs-1 col-sm-1">{{ event.visible ? '-' : '+' }}</div>
            <div class="col-xs-11 col-sm-5 event-name">{{ event.name }}</div>
            <div class="col-xs-3 col-sm-2 event-count">
                [{{ event.participants.length }}/{{event.maxParticipants}}&nbsp;+{{ event.alternates.length }}]
            </div>
            <div class="col-xs-9 col-sm-4 event-date">
                <span>{{ event.date }}</span> <span v-bind:class="{ 'tz-warning': event.tzWarning }">{{ event.tz }}</span>
            </div>
        </div>
        <div class="row" v-if="event.visible">
            <div class="col-xs-12 col-sm-6 participant-list">
                Participants [{{event.participants.length}}/{{event.maxParticipants}}]
                <participant-item 
                    v-for="participant in event.participants"
                    v-bind:participant="participant"
                    v-bind:event="event"
                    v-bind:key="participant.id">
                </participant-item>
                <div v-if="event.canJoin" 
                    v-on:click="join('participant')"
                    class="participant join">[ join ]
                </div>
            </div>
            <div class="col-xs-12 col-sm-6 participant-list">
                Alternates [{{event.alternates.length}}]
                <participant-item 
                    v-for="alternate in event.alternates"
                    v-bind:participant="alternate"
                    v-bind:event="event"
                    v-bind:key="alternate.id">
                </participant-item>
                <div v-if="event.canJoin" 
                    v-on:click="join('alternate')"
                    class="participant join">[ join ]
                </div>
            </div>
        </div>
    </div>
    </script>

    <script type="text/x-template" id="channel-item-template">
    <div>

        <div class="container-fluid channel" v-on:click="toggleVisible">
            <div class="row">
                <div class="col-xs-1">{{ channel.visible ? '-' : '+' }}</div>
                <div class="col-xs-9 channel-title">
                {{ channel.name }} </div>
                <div class="col-xs-2 channel-count">[{{ channel.events.length }}]</div>
            </div>
        </div>
        <template v-if="channel.visible">
            <event-item 
                v-for="event in channel.events"
                v-bind:event="event"
                v-bind:key="event.id">
            </event-item>
            <div class="container-fluid event">
                <div class="row event-header" 
                         v-if="!newEvent">
                    <div class="col-xs-12 event-new" 
                        v-on:click="newEvent = true">create new event</div>
                </div>
                <div class="row event-header form-group-lg" v-if="newEvent" >
                    <div class="col-xs-12 col-sm-12">
                        <p>New Event:</p>    
                        <input class="form-control" v-model="event.name" 
                            maxlength="256" placeholder="Event name (Min 10 characters)">
                    </div>
                    <div class="col-xs-12 col-sm-5 picker">
                        <select v-model="event.date">
                            <option v-for="option in dates" v-bind:value="option.value">
                                {{ option.text }}
                            </option>
                        </select>

                    </div>
                    <div class="col-xs-12 col-sm-5 picker">
                        <select v-model="event.hour">
                            <option v-for="option in hours" v-bind:value="option">
                                {{ option }}
                            </option>
                        </select>
                        <select v-model="event.minutes">
                            <option v-for="option in minutes" v-bind:value="option">
                                {{ option }}
                            </option>
                        </select>    
                        <select v-model="event.period">
                            <option v-for="option in periods" v-bind:value="option">
                                {{ option }}
                            </option>
                        </select>  
                        <span v-bind:class="{ 'tz-warning': event.tzWarning }">{{ event.tz }}</span>
                    </div>
                    <div class="clearfix hidden-sm-up"></div>
                    <div class="col-xs-12 col-sm-5 picker">
                        Max Participants
                        <select v-model="event.maxParticipants">
                            <option v-for="option in [2, 3, 4, 5, 6, 7, 8]" v-bind:value="option">
                                {{ option }}
                            </option>
                        </select>   
                    </div>
                    <div class="col-xs-12 col-sm-5 picker">
                        Reserved Places
                        <select v-model="event.reserved">
                            <option v-for="option in reservedSlots" v-bind:value="option">
                                {{ option }}
                            </option>
                        </select>   
                    </div>
                    <div class="clearfix hidden-sm-up"></div>
                    <div class="col-xs-9 col-sm-10 picker">
                        <button type="button" 
                            class="btn btn-success"
                            v-on:click="create()"
                            v-bind:disabled="event.name.length < 10">Submit</button>
                    </div>
                    <div class="col-xs-3 col-sm-2 picker">
                        <button type="button" 
                                v-on:click="newEvent = false"
                                class="btn btn-danger">Cancel</button>
                    </div>
                </div>
            </div>

        </template>
    </div>
    </script>

</head>

<body>
    <div class="app" id="app"> 
        <div class="error" 
            v-cloak
            v-show="error.message" 
            v-on:click="error.detailVisible = !error.detailVisible">
            <p class="error-message">{{ error.message }}</p>
            <pre class="error-detail" v-show="error.detailVisible">{{ error.detail }}</pre>
        </div>
        <div class="title">8bN Events</div>
        <div v-bind:class="{ 'loading': inProgress }"></div>
        <div v-cloak v-show="warning.message" class="container-fluid channel warning">
            <div class="row">
                <div class="col-xs-12 channel-title">
                    <a v-if="warning.url" v-bind:href="warning.url" class="warning">
                    {{ warning.message }}
                    </a>
                    <p v-else>{{ warning.message }}<p>
                </div>
            </div>
        </div>
        <channel-item
            v-for="channel in channels"
            v-bind:channel="channel"
            v-bind:key="channel.id">
        </channel-item>

        <div style="display:none" id="detect" class="container-fluid channel">
            <div class="row">
                <div class="col-xs-12 channel-title">
                        Sorry, this app will not work with this browser
                </div>
            </div>
        </div>
        <noscript>
            <div class="container-fluid channel">
                <div class="row">
                    <div class="col-xs-12 channel-title">
                        This app requires JavaScript enabled
                    </div>
                </div>
            </div>
        </noscript>
    </div>
    <script src="/js/detect.js"></script>
    <script src="/js/events.js"></script>
</body>

</html>
